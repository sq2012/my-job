function initwindow(){outerLayout=$("body").layout(layoutSettings_default);$tabs=$("#g_tabs").tabs({heightStyle:"fill",activate:function(a,b){g_activeTabID=$("#g_tabs").getActiveTabID()}}).charmingtabs({closable:1==tabs_style,showNavWhenNeeded:!0,closeTitle:"Close",onTabClose:function(a,b){if(-1!=b.indexOf("_checktranslog_")||-1!=b.indexOf("_getRTlog"))"undefined"!=typeof logtimer1&&clearTimeout(logtimer1),"undefined"!=typeof logtimer2&&clearTimeout(logtimer2)}});g_activeTabID=$("#g_tabs").getActiveTabID()}function initwindow_tabs(a,b){if(void 0==a||""==a)a=g_activeTabID;layoutSettings_Outer.west.initClosed=!1;initwest=0;for(var c in initCloseWest)initCloseWest[c]==g_activeTabID&&(initwest=1);if(b||1==initwest)layoutSettings_Outer.west.initClosed=!0;$("#"+a).layout(layoutSettings_Outer).resizeAll()}function initMenus(){$("#mainmenu .nav_main li a").click(function(){var a=$(this).attr("rel"),b=$("#"+a).find(".sub_op_menu\x3eli").first().width(),c=$("#"+a).find(".sub_op_menu\x3eli").length;$("div[class*\x3d'submenu']").hide();var d=$(this).offset().left,f=200;1200-c*b>d?(f=d-30,2<c&&(f=d-100)):f=1200-c*b-100;$(".sub_op_menu").css("left",f);$(this).attr("class")&&-1!=$(this).attr("class").indexOf("disabled")||($(".nav_main li a").removeClass("nav_on"),$("#mainmenu_con li a").removeClass("active"),$(this).addClass("nav_on"),$("#"+a).mouseleave(function(){$("#"+a).hide();$("#mainmenu_con .menuCloseBtn").hide()}),$(".submenu li ul\x3eli").on("click",function(b){$("#"+a).hide();$("#mainmenu_con .menuCloseBtn").hide()}),$("#mainmenu_con .menuCloseBtn").show(),$("#mainmenu_con .menuCloseBtn").click(function(){$("#"+a).hide();$(this).hide()}),$("#"+a).css({display:"block",left:0}),mod_name!=a&&"system"!=a&&"submenutitle nav_on"!=$(this).attr("class")&&($tabs.closeAllTab(),"undefined"!=typeof logtimer1&&clearTimeout(logtimer1),"undefined"!=typeof logtimer2&&clearTimeout(logtimer2),mod_name=a,menuClick("/iclock/homepage/showHomepage/?mod_name\x3d"+mod_name,null),initwindow_tabs("tab_id_menu_home")))});$("#mainmenu .nav_main li a").click(function(){return!1})}function initInnerWindow(){innerLayout=$("#report_module").layout(innerSettings_default)}function getContentHTML(a,b,c){void 0==c?c=" #id_content":html=" "+html;-1!=a.indexOf("data/userRoles")&&savecookie("search_urlstr",a);urll=-1!=a.indexOf("?")?a+"\x26stamp\x3d"+moment().unix():a+"?stamp\x3d"+moment().unix();-1==urll.indexOf("mod_name")&&(urll=urll+"\x26mod_name\x3d"+mod_name);$.ajax({type:"GET",url:urll,data:"",dataType:"text",success:function(a){$("#"+b+c).html(a)},error:function(){}})}function addTab(a,b,c){g_activeTabID="tab_"+a;li=$("\x3cli\x3e\x3ca href\x3d'#{href}'\x3e#{label}\x3c/a\x3e \x3c/li\x3e".replace(/#\{href\}/g,"#tab_"+a).replace(/#\{label\}/g,b));tabT=$("#g_tabs");tabT.find(".ui-tabs-nav:first").append(li);tabT.append("\x3cdiv id\x3dtab_"+a+"\x3e\x3cdiv class\x3d'ui-layout-west ui-widget-content'\x3e\x3cdiv id\x3d'id_west' class\x3d'ui-widget-header' style\x3d'height: 24px;padding-top: 0px;'\x3e\x3c/div\x3e\x3cdiv id\x3d'west_content_"+g_activeTabID+"' class\x3d'west-content'\x3e \x3c/div\x3e\x3c/div\x3e\x3cDIV id\x3d'id_content' class\x3d'tab-ui-layout-center ui-layout-center' \x3e\x3c/DIV\x3e\x3c/div\x3e");tabT.tabs("refresh");tabT.tabs("option","active",-1);initwindow_tabs()}function menuClick(a,b,c){id="id_menu_home";b&&(id=$(b).attr("id"));if("undefined"!=typeof a&&""!=a&&"#"!=a){"undefined"!=typeof id_card_setinterval&&(clearInterval(id_card_setinterval),clearTimeout(id_card_setinterval));"/ipos/data/CardCashSZ/"==a&&(pos_start_date||(pos_start_date=moment().startOf("month").format("YYYY-MM-DD")),pos_end_date||(pos_end_date=moment().endOf("month").format("YYYY-MM-DD")),a+="?checktime__gte\x3d"+pos_start_date+"\x26checktime__lte\x3d"+pos_end_date+" 23:59:59");delcookie("search_urlstr");g_url=a;g_urls["tab_"+id]=a;if("/iclock/iacc/Map_Monitor/"==a)return window.open("/iclock/iacc/Map_Monitor/","","fullscreen\x3dyes"),!1;if("/acc/_checkinoutlog_/"==a)return window.open("/acc/_checkinoutlog_/","","fullscreen\x3dyes"),!1;"id_menu_home"==id?($tabs.selectTabByID("tab_"+id),getContentHTML(a,"tab_"+id)):1==tabs_style?0>$tabs.getIndexByID("tab_"+id)?(addTab(id,$(b).text(),""),getContentHTML(a,"tab_"+id),g_urls["tab_"+id]=a):($tabs.selectTabByID("tab_"+id),getContentHTML(a,"tab_"+id)):($tabs.closeAllTab(),"undefined"!=typeof logtimer1&&clearTimeout(logtimer1),"undefined"!=typeof logtimer2&&clearTimeout(logtimer2),addTab(id,$(b).text(),""),g_activeTabID=$("#g_tabs").getActiveTabID(),g_urls[g_activeTabID]=a,getContentHTML(a,"tab_"+id));return!1}}function submenuClick(a,b){IsShowLeftInfo=!1;"undefined"!=typeof id_card_setinterval&&(clearInterval(id_card_setinterval),clearTimeout(id_card_setinterval));"undefined"!=typeof b&&($("#"+g_activeTabID+" #menu_div li").removeClass("subnav_on"),$(b).addClass("subnav_on"));delcookie("search_urlstr");g_url=a;g_urls[g_activeTabID]=a;getContentHTML(a,g_activeTabID)}function preprocessEdit(){"function"==typeof canEdit&&canEdit()}function get_grid_fields(a){grid_fieldnames[g_activeTabID]=[];grid_fieldcaptions[g_activeTabID]=[];grid_frozenfields[g_activeTabID]=[];for(var b=0;b<a.colModel.length;b++)"undefined"==typeof a.colModel[b].label||"undefined"!=a.colModel[b].hidden&&a.colModel[b].hidden||(a.colModel[b].frozen&&grid_frozenfields[g_activeTabID].push(a.colModel[b].name),grid_fieldnames[g_activeTabID].push(a.colModel[b].name),grid_fieldcaptions[g_activeTabID].push(a.colModel[b].label))}function ShowCustomField(a){var b='\x3cdiv\x3e\x3cform id\x3d"id_form"\x3e\x3ctable\x3e'+createFieldsChk()+"\x3c/table\x3e\x3c/form\x3e\x3c/div\x3e";$("#id_fields_selected").html(b);showSelected_Fields();showFields(a)}function saveDefineFields(a){var b=getunSelected_Fields();$.post("/iclock/att/saveFields/","tblName\x3d"+tblName[g_activeTabID]+"\x26Fields\x3d"+b,function(a,d){0==a.ret&&(hideFields_define(),grid_disabledfields[g_activeTabID]=b,0<jqOptions[g_activeTabID].pager.indexOf("report")?($("#id_grid_report").jqGrid("showCol",grid_fieldnames[g_activeTabID]),$("#id_grid_report").jqGrid("hideCol",b)):($("#id_grid_"+tblName[g_activeTabID]).jqGrid("showCol",grid_fieldnames[g_activeTabID]),$("#id_grid_"+tblName[g_activeTabID]).jqGrid("hideCol",b)))},"json")}function createFieldsChk(){for(var a="\x3ctr\x3e\x3ctd\x3e\x3cdiv id\x3d'select_div'\x3e\x3cinput type\x3d'checkbox' id\x3d'is_select_all_Field'  onclick\x3d'check_all_for_row_Fields(this.checked);' /\x3e"+gettext("Selected:")+" \x3cspan id\x3d'selected_count_Fields'\x3e0\x3c/span\x3e)\x3c/td\x3e\x3c/tr\x3e",b=0;b<grid_fieldnames[g_activeTabID].length;b++)a=isDisabled(grid_fieldnames[g_activeTabID][b])?a+("\x3ctr\x3e\x3ctd\x3e\x3cinput type\x3d'checkbox'  alt\x3d'"+grid_fieldnames[g_activeTabID][b]+"' class\x3d'class_select_Fields' onclick\x3d'showSelected_Fields();'/\x3e"+grid_fieldcaptions[g_activeTabID][b]+"\x3c/td\x3e\x3c/tr\x3e"):"PIN"==grid_fieldnames[g_activeTabID][b]||"EName"==grid_fieldnames[g_activeTabID][b]||0==b||-1!=grid_frozenfields[g_activeTabID].indexOf(grid_fieldnames[g_activeTabID][b])?a+("\x3ctr\x3e\x3ctd\x3e\x3cinput type\x3d'checkbox' checked  disabled/\x3e"+grid_fieldcaptions[g_activeTabID][b]+"\x3c/td\x3e\x3c/tr\x3e"):a+("\x3ctr\x3e\x3ctd\x3e\x3cinput type\x3d'checkbox'  alt\x3d'"+grid_fieldnames[g_activeTabID][b]+"' class\x3d'class_select_Fields' onclick\x3d'showSelected_Fields();' checked/\x3e"+grid_fieldcaptions[g_activeTabID][b]+"\x3c/td\x3e\x3c/tr\x3e");return a}function isDisabled(a){for(var b=0;b<grid_disabledfields[g_activeTabID].length;b++)if(grid_disabledfields[g_activeTabID][b]==a)return 1;return 0}function hiddenfields(a){for(var b=0;b<a.colModel.length;b++)isDisabled(a.colModel[b].name)&&(a.colModel[b].hidden=!0)}function showFields(a){$("#show_field_selected").dialog({dialogClass:"no-close",modal:!0,width:300,height:400,resizable:!1,buttons:[{id:"btn_DefineField",text:gettext("Submit"),click:function(){saveDefineFields(a)}},{id:"btnShowCancel",text:gettext("Cancel"),click:function(){$(this).dialog("destroy");$("#id_fields_selected").empty()}}],position:{my:"left top",at:"left bottom",of:"#"+g_activeTabID+" #id_custom"}})}function hideFields_define(a){$("#show_field_selected").dialog("destroy");$("#id_fields_selected").empty()}function showSelected_Fields(){var a=0;$.each($(".class_select_Fields"),function(){this.checked&&(a+=1)});$("#selected_count_Fields").html(""+a)}function check_all_for_row_Fields(a){a?$(".class_select_Fields").prop("checked",!0):$(".class_select_Fields").removeAttr("checked");showSelected_Fields()}function getunSelected_Fields(){var a=[];$.each($(".class_select_Fields"),function(){this.checked||a.push(this.alt)});return a}function formToRequestString(a){for(var b="",c="",d=0;d<a.length;d++)if(e=a[d],e.name){if("select-one"==e.type)-1==e.selectedIndex&&(e.selectedIndex=0),element_value=e.options[e.selectedIndex].value;else if("select-multiple"==e.type){for(var f=0;f<e.length;f++){var g=e.options[f];g.selected&&(b+=c+e.name+"\x3d"+encodeURIComponent(g.value),c="\x26")}continue}else if("checkbox"==e.type||"radio"==e.type){if(0==e.checked)continue;element_value=e.value}else if("undefined"!=typeof e.value)element_value=e.value;else continue;b+=c+e.name+"\x3d"+encodeURIComponent(element_value);c="\x26"}return b}function savecookie(a,b,c){"search_urlstr"==a&&(g_search_urls[g_activeTabID]=b);return $.cookie(a+g_activeTabID,b)}function loadcookie(a){return"search_urlstr"==a?g_search_urls[g_activeTabID]?g_search_urls[g_activeTabID]:"":$.cookie(a+g_activeTabID)}function delcookie(a){$.cookie(a+g_activeTabID,"");g_search_urls[g_activeTabID]=""}function clickexport(a,b){var c=loadcookie("search_urlstr");if(void 0==c||""==c)alert("\u65e0\u5bfc\u51fa\u6761\u4ef6");else{-1!=c.indexOf("/data/")?c=c.replace("/data/","/export/"):-1!=c.indexOf("/att/")?c=c.replace("/att/","/export/"):-1!=c.indexOf("/iacc/")?c=c.replace("/iacc/","/export/"):-1!=c.indexOf("/report/")&&(c=c.replace("/report/","/export/"));c=-1!=c.indexOf("?")?c+"\x26exporttblName\x3d"+a+"\x26page\x3d1\x26rows\x3d100000\x26exporttype\x3d"+b+"\x26mod_name\x3d"+mod_name:c+"?exporttblName\x3d"+a+"\x26page\x3d1\x26rows\x3d100000\x26exporttype\x3d"+b+"\x26mod_name\x3d"+mod_name;if($.isFunction(window["getSidx_"+tblName[g_activeTabID]]))sidxs=window["getSidx_"+tblName[g_activeTabID]]();else try{sidxs=jqOptions[g_activeTabID].sortname}catch(d){}void 0!=sidxs&&""!=sidxs&&(sidxs=encodeURIComponent(sidxs),str=-1==c.indexOf("?")?"?sidx\x3d"+sidxs:"\x26sidx\x3d"+sidxs,c+=str);1==b?window.location.href=c:($.blockUI({title:"",theme:!0,baseZ:1E4,message:'\x3ch1\x3e\x3cimg src\x3d"/media/img/loading.gif" /\x3e \x3cbr\x3e'+gettext("Please wait...")+"\x3c/br\x3e\x3c/h1\x3e"}),$.ajax({type:"POST",url:c,data:{page:1,rows:1E5},success:function(a){window.location.href=a;$.unblockUI()}}))}}function stripHtml(a){return $.jgrid.stripHtml(a).replace(RegExp("\x26nbsp;","gm"),"")}function saveHome(){$.post("/base/isys/saveHome/?mod_name\x3d"+mod_name+"\x26tab\x3d"+g_activeTabID+"\x26caption\x3d"+escape($("a[href\x3d#"+g_activeTabID+"]").html()),{url:g_urls[g_activeTabID]},function(a,b){0==a.ret&&alert(a.message)},"json")}function unescapeHTML(a){return a=String(a).replace(/&gt;/g,"\x3e").replace(/&lt;/g,"\x3c").replace(/&quot;/g,'"').replace(/&amp;/g,"\x26")}function SetGridWidth(a){a=$("#"+g_activeTabID+" #id_content").width()-10;$("#id_grid_"+tblName[g_activeTabID]).jqGrid("setGridWidth",a);var b=$("#id_content").height();a=0<$("#id_top_report").length?$("#id_top_report").height():0;var c=$("#showReportSymbol").height(),b=b-a;0<a&&($("#report_module").css("height",b),$("#id_grid_report").setGridHeight(b-70-c))}(function(a){a.fn.iMenu=function(){var b=0;0!=a(this).length&&a(this).hover(function(){b=a(this).position().top+a(this).height()+13;a(this).children("ul").css("display","block");var c=a(this).position().left;a(this).offset();var d=a(this).children("ul").width(),f=c+d-880;880<c+d?(a(this).children("ul").css("display","block"),a(this).children("ul").css({left:c-f,top:b})):(a(this).children("ul").css("display","block"),a(this).children("ul").css({left:c,top:b}));h=a(this).find("\x3eli").children("ul").height();a(this).find("\x3eul\x3eli").css({height:h});a(this).children("ul").css("display","block")},function(){a(this).children("ul").css("display","none")})}})(jQuery);