/********************读卡：判断读卡方式是否正确****************/function clearNoNum(a){a.bind("onkeyup",function(){a.value=a.value.replace(/[^\d.]/g,"");a.value=a.value.replace(/^\./g,"");a.value=a.value.replace(/\.{2,}/g,".");a.value=a.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".")})}function readCardSleep(){}function readCard(){var a=zkonline.ZK_PosReadCardSerial(0);readCardSleep();var b=zkonline.ZK_PosReadCardSerial(0);return a!=b?"999":a}function check_card(a){switch(a.toString()){case "999":return $("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u5361\u53f7\u4e0d\u4e00\u81f4,\u64cd\u4f5c\u5931\u8d25\uff01\x3c/li\x3e\x3c/ul\x3e').show(),!1;case "-2":return $("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u4e3b\u5907\u6247\u533a\u6570\u636e\u4e0d\u4e00\u81f4\uff0c\u8be5\u5361\u7247\u9700\u8981\u5728\u6d88\u8d39\u673a\u4e0a\u5237\u4e00\u6b21\u540e\uff0c\u624d\u80fd\u6b63\u5e38\u4f7f\u7528\x3c/li\x3e\x3c/ul\x3e').show(),!1;case "131":return $("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u6ca1\u6709\u627e\u5230IC\u5361\u6216\u8005\u5361\u662f\u5426\u635f\u574f\x3c/li\x3e\x3c/ul\x3e').show(),!1;case "140":return $("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u6247\u533a\u5bc6\u7801\u9519\u8bef\x3c/li\x3e\x3c/ul\x3e').show(),!1;case "5":return $("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u8bf7\u8fde\u63a5\u8bfb\u5361\u5668\x3c/li\x3e\x3c/ul\x3e').show(),!1;case "-1":return $("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u4f20\u5165\u53c2\u6570\u9519\u8bef\x3c/li\x3e\x3c/ul\x3e').show(),!1}}function stringToBytes(a){for(var b,c,d=[],e=0;e<a.length;e++){b=a.charCodeAt(e).toString(16);c=[];do c.push(b&255),b>>=8;while(b);d=d.concat(c.reverse())}return d}function isEmptyCard(){var a=zkonline.ZK_PosReadICCard(0,stringToBytes(sys_pwd),main_fan,minor_fan),b=a.split(","),c=!1;if(1<b.length){for(i=0;2>i;i++)if(0==b[i].split("\x3d")[1]&&0==b[4].split("\x3d")[1]&&0==b[6].split("\x3d")[1])c=!0;else{c=!1;break}return c}return a}function isOnline(){if(/edge/.test(navigator.userAgent.toLowerCase()))return $("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u5f53\u524d\u64cd\u4f5c\u4e0d\u652f\u6301Edge\u6d4f\u89c8\u5668\uff0c\u8bf7\u6253\u5f00IE11\x3c/li\x3e\x3c/ul\x3e').show(),!1;if(/msie/.test(navigator.userAgent.toLowerCase())||/trident/.test(navigator.userAgent.toLowerCase())){try{t=zkonline.ZK_PosReadCardSerial(0)}catch(a){return $("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u5f53\u524d\u9a71\u52a8\u4e0d\u6b63\u786e\x3c/li\x3e\x3c/ul\x3e'),!1}if("5"!=t)return $("#read_card").attr("disabled",""),$("#read_card").attr("style","none"),!0;$("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u8bf7\u8fde\u63a5\u53d1\u5361\u5668\x3c/li\x3e\x3c/ul\x3e');return!1}$("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u5f53\u524d\u64cd\u4f5c\u53ea\u652f\u6301IE\u6838\u5fc3\u6d4f\u89c8\u5668(\u5982IE,360\u517c\u5bb9\u6a21\u5f0f,\u641c\u72d7\u6d4f\u89c8\u5668,QQ\u6d4f\u89c8\u5668)\x3c/li\x3e\x3c/ul\x3e').show();return!1}function writeICMoney(a,b,c,d,e,f){return zkonline.ZK_PosWriteICCardMoney(a,b,c,e,f)}function isvild_write_card(a,b,c,d){return!0}function isvild_write_Add_card(a,b,c,d){return!0}function funValidCard(){var a=$("#id_edit_form_consume").formSerialize(),b=!1;$.ajax({type:"POST",url:"/ipos/valid_card/",data:a,dataType:"json",cache:!1,async:!1,success:function(a){switch(a.ret){case "OK":b=!0;break;case "PRIVAGE_CARD":$("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u5f53\u524d\u64cd\u4f5c\u5361\u7247\u4e3a\u7ba1\u7406\u5361\uff0c\u64cd\u4f5c\u5931\u8d25\uff01\x3c/li\x3e\x3c/ul\x3e');b=!1;break;case "CARD_STOP":$("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u5f53\u524d\u64cd\u4f5c\u5361\u7247\u4e3a\u505c\u7528\u5361\uff0c\u64cd\u4f5c\u5931\u8d25\uff01\x3c/li\x3e\x3c/ul\x3e');b=!1;break;case "CARD_LOST":$("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u5f53\u524d\u64cd\u4f5c\u5361\u7247\u4e3a\u6302\u5931\u5361\uff0c\u64cd\u4f5c\u5931\u8d25\uff01\x3c/li\x3e\x3c/ul\x3e');b=!1;break;case "Not_REGISTER_CARD":$("#id_error").append('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u5f53\u524d\u64cd\u4f5c\u5361\u7247\u6ca1\u6709\u767b\u8bb0\u5361\u8d26\u53f7\uff0c\u64cd\u4f5c\u5931\u8d25\uff01\x3c/li\x3e\x3c/ul\x3e');b=!1;break;case "CARD_OVERDUE_VALID":$("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u8bf7\u5148\u6302\u5931\u5361\u7247\uff0c\u64cd\u4f5c\u5931\u8d25\x3c/li\x3e\x3c/ul\x3e'),b=!1}}});return b}function page_valid(a,b){val_tag=!1;switch(a){case "1":val_tag=!0;break;case "3":$("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u5f53\u524d\u64cd\u4f5c\u5361\u7247\u4e3a\u6302\u5931\u5361\uff0c\u4e0d\u5141\u8bb8\u64cd\u4f5c\uff01\x3c/li\x3e\x3c/ul\x3e');val_tag=!1;break;case "5":$("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u5f53\u524d\u64cd\u4f5c\u5361\u7247\u4e3a\u505c\u7528\u5361\uff0c\u4e0d\u5141\u8bb8\u64cd\u4f5c\uff01\x3c/li\x3e\x3c/ul\x3e');val_tag=!1;break;case "4":"1"==b?($("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u5f53\u524d\u64cd\u4f5c\u5361\u7247\u4e3a\u8fc7\u671f\u5361\uff0c\u4e0d\u5141\u8bb8\u64cd\u4f5c\uff01\x3c/li\x3e\x3c/ul\x3e'),val_tag=!1):val_tag=!0}return val_tag}function funSaveBakData(a){var b=!1;a=a?a.formSerialize():$("#id_edit_form_consume").formSerialize();$.ajax({type:"POST",url:"/ipos/save_operate_bak_data/",data:a,dataType:"json",cache:!1,async:!1,success:function(a){switch(a.ret){case "OK":b=!0;break;case "FAIL":$("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u7cfb\u7edf\u51fa\u9519\uff0c\u64cd\u4f5c\u5931\u8d25\uff01\x3c/li\x3e\x3c/ul\x3e');b=!1;break;case "PRIVAGE_CARD":$("#error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u5f53\u524d\u64cd\u4f5c\u5361\u7247\u4e3a\u7ba1\u7406\u5361\uff0c\u64cd\u4f5c\u5931\u8d25\uff01\x3c/li\x3e\x3c/ul\x3e');b=!1;break;case "CARD_LOST":$("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u5f53\u524d\u64cd\u4f5c\u5361\u7247\u4e3a\u6302\u5931\u5361\uff0c\u64cd\u4f5c\u5931\u8d25\uff01\x3c/li\x3e\x3c/ul\x3e');b=!1;break;case "CARD_STOP":$("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u5f53\u524d\u64cd\u4f5c\u5361\u7247\u4e3a\u505c\u7528\u5361\uff0c\u64cd\u4f5c\u5931\u8d25\uff01\x3c/li\x3e\x3c/ul\x3e');b=!1;break;case "CARD_OVERDUE":$("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u5f53\u524d\u64cd\u4f5c\u5361\u7247\u4e3a\u8fc7\u671f\u5361\uff0c\u64cd\u4f5c\u5931\u8d25\uff01\x3c/li\x3e\x3c/ul\x3e');b=!1;break;case "IS_NEGATIVE_NUMBER":$("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u91d1\u989d\u4e0d\u80fd\u4e3a\u8d1f\u6570\x3c/li\x3e\x3c/ul\x3e');b=!1;break;case "IS_ZERO":$("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u91d1\u989d\u4e0d\u80fd\u4e3a\u96f6\x3c/li\x3e\x3c/ul\x3e');b=!1;break;case "OUT_LESSMONEY":$("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u4f4e\u4e8e\u5361\u7c7b\u6700\u5c0f\u4f59\u989d\x3c/li\x3e\x3c/ul\x3e');b=!1;break;case "OUT_MAXMONEY":$("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u8d85\u51fa\u5361\u7c7b\u6700\u5927\u4f59\u989d\x3c/li\x3e\x3c/ul\x3e'),b=!1}}});return b}function get_sys_card_no(){var a=!1;$.ajax({type:"POST",url:"/ipos/get_sys_card_no/",data:"",dataType:"json",cache:!1,async:!1,success:function(b){switch(b.ret){case "OK":$("#id_sys_card_no").val(b.message);a=!0;break;case "FAIL":a=!1}}});return a}function funSaveAddCardBakData(a){var b=!1;a=a?a.formSerialize():$("#id_edit_form_consume").formSerialize();$.ajax({type:"POST",url:"/ipos/save_add_card_bak_data/",data:a,dataType:"json",cache:!1,async:!1,success:function(a){switch(a.ret){case "OK":$("#id_sys_card_no").val(a.message);b=!0;break;case "FAIL":$("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u5236\u5361\u5931\u8d25\x3c/li\x3e\x3c/ul\x3e');b=!1;break;case "CARD_LOST":$("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u5f53\u524d\u5361\u53f7\u5df2\u7ecf\u6302\u5931\x3c/li\x3e\x3c/ul\x3e');b=!1;break;case "CARD_STOP":$("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u5f53\u524d\u5361\u53f7\u5df2\u7ecf\u505c\u7528\uff0c\u8bf7\u5148\u505a\u65e0\u5361\u9000\u5361\u64cd\u4f5c\x3c/li\x3e\x3c/ul\x3e');b=!1;break;case "HAVECARD":$("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u8be5\u4eba\u5458\u5df2\u6709\u6b63\u5728\u4f7f\u7528\u7684\u5361\x3c/li\x3e\x3c/ul\x3e');b=!1;break;case "EMPNOTCARD":$("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u5f53\u524d\u5361\u53f7\u5df2\u767b\u8bb0\u4eba\u5458\u8ddf\u5b9e\u9645\u53d1\u5361\u4eba\u5458\u4e0d\u4e00\u81f4\uff0c\u8bf7\u6838\u5bf9\u540e\u518d\u53d1\u5361\x3c/li\x3e\x3c/ul\x3e');b=!1;break;case "ISUSE":$("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u5f53\u524d\u5361\u53f7\u5df2\u88ab\u4f7f\u7528\uff0c\u5982\u9700\u7ee7\u7eed\u4f7f\u7528\u8be5\u5361\uff0c\u8bf7\u5148\u9000\u5361\uff01\x3c/li\x3e\x3c/ul\x3e');b=!1;break;case "OUT_LESSMONEY":$("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u4f4e\u4e8e\u5361\u7c7b\u6700\u5c0f\u4f59\u989d\x3c/li\x3e\x3c/ul\x3e');b=!1;break;case "OUT_MAXMONEY":$("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u8d85\u51fa\u5361\u7c7b\u6700\u5927\u4f59\u989d\x3c/li\x3e\x3c/ul\x3e');b=!1;break;case "SYS_ISUSE":$("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u5361\u8d26\u53f7\u5df2\u4f7f\u7528\uff0c\u8bf7\u5237\u65b0\u5f53\u524d\u9875\u9762\uff01\x3c/li\x3e\x3c/ul\x3e'),b=!1}}});return b}function funSaveIssuecardData(a){var b=!1;a=a?a.formSerialize():$("#id_edit_form_consume").formSerialize();$.ajax({type:"POST",url:"/ipos/save_issuecard_data/",data:a,dataType:"json",cache:!1,async:!1,success:function(a){switch(a.ret){case "OK":b=!0;break;case "FAIL":b=!1}}});return b}function funSaveCardManage(){var a="",b=$("#id_edit_form_consume").formSerialize();$.ajax({type:"POST",url:"/ipos/save_card_manage/",data:b,dataType:"json",cache:!1,async:!1,success:function(b){switch(b.ret){case "OK":a="OK";break;case "FAIL":a="FAIL";break;case "ISUSE":$("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u5f53\u524d\u5361\u53f7\u5df2\u88ab\u4f7f\u7528\uff0c\u5982\u9700\u4f7f\u7528\u8be5\u5361,\u8bf7\u5148\u9000\u5361\uff01\x3c/li\x3e\x3c/ul\x3e');a="ISUSE";break;case "SYS_ISUSE":$("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u5361\u8d26\u53f7\u5df2\u4f7f\u7528,\u8bf7\u5237\u65b0\u5f53\u524d\u9875\u9762\uff01\x3c/li\x3e\x3c/ul\x3e'),a="SYS_ISUSE"}}});return a}function from_close(){$("#id_datalist").get(0).g.load_data();$("#Cancel").click()}function funChangeCardInfo(){var a=!1,b=$("#id_edit_form_consume").formSerialize();$.ajax({type:"POST",url:"/ipos/change_card_info/",data:b,dataType:"json",cache:!1,async:!1,success:function(b){switch(b.ret){case "OK":a=!0;break;case "FAIL":a=!1}}});return a}function funSaveData(a){var b=!1;a=a?a.formSerialize():$("#id_edit_form_consume").formSerialize();$.ajax({type:"POST",url:"/ipos/save_operate_data/",data:a,dataType:"json",cache:!1,async:!1,success:function(a){switch(a.ret){case "OK":b=!0;break;case "FAIL":$("#id_error").html('\x3cul class\x3d"errorlist"\x3e\x3cli\x3e\u7cfb\u7edf\u51fa\u9519\uff0c\u64cd\u4f5c\u5931\u8d25\uff01\x3c/li\x3e\x3c/ul\x3e'),b=!1}}});return b}$.validator.addMethod("isMoney",function(a,b){var c=/^(([1-9]\d*)|0)(\.\d{1,2})?$/;$("#"+b.id).bind("keyup",function(){this.value=this.value.replace(/[^\d.]/g,"");this.value=this.value.replace(/^\./g,"");this.value=this.value.replace(/\.{2,}/g,".");this.value=this.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".")});return this.optional(b)||c.exec(a)},$.validator.format("\u9519\u8bef"));